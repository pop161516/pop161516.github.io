<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assignment3</title>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="style.css" />
    <style>
      .center-button {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 30px;
        font-size: 1.2em;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 100;
        display: none;
        /* Add some margin to separate the buttons if both are shown */
        margin-top: 0px; /* Default */
      }

      /* Adjust position for the first button */
      #changeVideoButton {
        margin-top: -40px; /* Move it up slightly */
      }

      /* Style for the new second button */
      #secondChangeVideoButton {
        margin-top: 40px; /* Move it down slightly */
      }

      .vid {
        height: 200vh;
        overflow: hidden;
        position: relative;
      }

      .holder video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Highlighting style */
      .center-button.highlight {
        border: 2px solid #00f; /* Blue border for highlighting */
        box-shadow: 0 0 15px rgba(0, 0, 255, 0.6); /* Subtle glow */
        transition: all 0.3s ease-in-out; /* Smooth transition for visual effect */
      }
    </style>
  </head>
  <body>
    <section class="vid">
      <div class="holder">
        <video id="myVideo" muted loop playsinline>
          <source src="vid.mp4" type="video/mp4" />
        </video>
      </div>
    </section>

    <button id="changeVideoButton" class="center-button">
      Explore Equipment Rental
    </button>

    <button id="secondChangeVideoButton" class="center-button">
      See More Products
    </button>

    <script>
      const section = document.querySelector("section.vid");
      const vid = document.getElementById("myVideo");
      const changeVideoButton = document.getElementById("changeVideoButton"); // First button
      const secondChangeVideoButton = document.getElementById(
        "secondChangeVideoButton"
      ); // Second button

      // Define video sources as absolute paths for robust comparison
      const initialVideoSource = new URL("vid.mp4", window.location.href).href;
      const newVideoSource = new URL("new_vid.mp4", window.location.href).href;
      const thirdVideoSource = new URL("third_vid.mp4", window.location.href)
        .href; // New video source

      function scroll() {
        if (
          !vid ||
          isNaN(vid.duration) ||
          vid.duration === 0 ||
          vid.readyState < 2
        ) {
          console.warn("Video not ready â€” skipping scroll sync.");
          return;
        }

        const distance = window.scrollY - section.offsetTop;
        const total = section.clientHeight - window.innerHeight;
        const percentage = Math.max(0, Math.min(1, distance / total));

        vid.currentTime = vid.duration * percentage;

        const currentActiveSrc = vid.currentSrc || "";
        console.log("currentActiveSrc =", currentActiveSrc);

        // Determine which video is currently playing
        const isInitialVideo = currentActiveSrc === initialVideoSource;
        const isNewVideo = currentActiveSrc === newVideoSource;
        const isThirdVideo = currentActiveSrc === thirdVideoSource; // Check for third video

        console.log(
          `isInitialVideo: ${isInitialVideo}, isNewVideo: ${isNewVideo}, isThirdVideo: ${isThirdVideo}`
        );

        // --- Logic for the first button (changeVideoButton) ---
        let showFirstButton = false;
        let highlightFirstButton = false;

        if (isInitialVideo) {
          showFirstButton = percentage >= 0.95;
          changeVideoButton.textContent = "Explore Equipment Rental";
          highlightFirstButton = showFirstButton;
        } else if (isNewVideo) {
          showFirstButton = percentage <= 0.05;
          changeVideoButton.textContent = "Return to Main";
          highlightFirstButton = showFirstButton;
        } else {
          // If neither initial nor new video, hide the first button
          showFirstButton = false;
          highlightFirstButton = false;
        }

        changeVideoButton.style.display = showFirstButton ? "block" : "none";
        if (highlightFirstButton) {
          changeVideoButton.classList.add("highlight");
        } else {
          changeVideoButton.classList.remove("highlight");
        }

        // --- Logic for the second button (secondChangeVideoButton) ---
        let showSecondButton = false;
        let highlightSecondButton = false;

        if (isThirdVideo) {
          // Show at the beginning of third_vid.mp4
          showSecondButton = percentage <= 0.05;
          secondChangeVideoButton.textContent = "Return to Main"; // Or "Back to Menu"
          highlightSecondButton = showSecondButton;
        } else if (isInitialVideo) {
          // Show at the end of vid.mp4, alongside the first button
          // Or decide if it should appear only for third_vid.mp4
          // Based on your request: "shows up with the first button" implies at the end of vid.mp4
          showSecondButton = percentage >= 0.95;
          secondChangeVideoButton.textContent = "Floor 2";
          highlightSecondButton = showSecondButton;
        } else {
          // Hide the second button for other videos
          showSecondButton = false;
          highlightSecondButton = false;
        }

        secondChangeVideoButton.style.display = showSecondButton
          ? "block"
          : "none";
        if (highlightSecondButton) {
          secondChangeVideoButton.classList.add("highlight");
        } else {
          secondChangeVideoButton.classList.remove("highlight");
        }
      }

      // Refactored switchVideo function to accept the target video source
      function switchVideo(src) {
        vid.pause();

        // Remove old source(s)
        while (vid.firstChild) {
          vid.removeChild(vid.firstChild);
        }

        // Add new <source>
        const newSource = document.createElement("source");
        newSource.setAttribute("src", src);
        newSource.setAttribute("type", "video/mp4");
        vid.appendChild(newSource);

        vid.load();
        // The text content and display of buttons are now handled by the scroll function
        changeVideoButton.style.display = "none";
        secondChangeVideoButton.style.display = "none"; // Hide second button on switch

        // Scroll to top instantly
        window.scrollTo({ top: 0, behavior: "instant" });
      }

      // Event listener for the first button
      changeVideoButton.addEventListener("click", () => {
        const currentActiveSrc = vid.currentSrc || "";
        if (currentActiveSrc === initialVideoSource) {
          switchVideo(newVideoSource);
        } else if (currentActiveSrc === newVideoSource) {
          switchVideo(initialVideoSource);
        }
        // No action if on thirdVideoSource for this button
      });

      // Event listener for the second button (new)
      secondChangeVideoButton.addEventListener("click", () => {
        const currentActiveSrc = vid.currentSrc || "";
        if (currentActiveSrc === initialVideoSource) {
          switchVideo(thirdVideoSource); // From main to third video
        } else if (currentActiveSrc === thirdVideoSource) {
          switchVideo(initialVideoSource); // From third video back to main
        }
        // No action if on newVideoSource for this button
      });

      vid.addEventListener("loadedmetadata", () => {
        console.log("--- loadedmetadata event fired! ---");
        // Ensure scroll is called to update button states after video loads
        scroll();
      });

      window.addEventListener("scroll", scroll);
      window.addEventListener("DOMContentLoaded", scroll);

      // Initial call to set up button state correctly on page load
      // This will ensure the buttons are correctly hidden/shown based on initial video
      scroll();
    </script>
  </body>
</html>
