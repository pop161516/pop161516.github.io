<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assignment3</title>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="style.css" />
    <style>
      .center-button {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 30px;
        font-size: 1.2em;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 100;
        display: none;
      }

      .vid {
        height: 200vh;
        overflow: hidden;
        position: relative;
      }

      .holder video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <section class="vid">
      <div class="holder">
        <video id="myVideo" muted loop playsinline>
          <source src="vid.mp4" type="video/mp4" />
        </video>
      </div>
    </section>

    <button id="changeVideoButton" class="center-button">
      Explore Equipment Rental
    </button>

    <script>
      const section = document.querySelector("section.vid");
      const vid = document.getElementById("myVideo");
      const changeVideoButton = document.getElementById("changeVideoButton");

      const initialVideoSource = "vid.mp4";
      const newVideoSource = "new_vid.mp4";

      function scroll() {
        if (
          !vid ||
          isNaN(vid.duration) ||
          vid.duration === 0 ||
          vid.readyState < 2
        ) {
          console.warn("Video not ready â€” skipping scroll sync.");
          return;
        }

        const distance = window.scrollY - section.offsetTop;
        const total = section.clientHeight - window.innerHeight;
        const percentage = Math.max(0, Math.min(1, distance / total));

        vid.currentTime = vid.duration * percentage;

        const currentSrc = vid.currentSrc || "";
        console.log("currentSrc =", currentSrc);

        // Extract just the filename from the currentSrc
        const currentFileName = currentSrc.substring(
          currentSrc.lastIndexOf("/") + 1
        );

        const isInitialVideo = currentFileName === "vid.mp4"; // Check for exact filename
        const isNewVideo = currentFileName === "new_vid.mp4"; // Check for exact filename
        console.log(
          "isInitialVideo:",
          isInitialVideo,
          "isNewVideo:",
          isNewVideo
        );

        let showButton = false;

        if (isInitialVideo) {
          showButton = percentage >= 0.95;
          changeVideoButton.textContent = "Explore Equipment Rental"; // Set button label for initial video
        } else if (isNewVideo) {
          showButton = percentage <= 0.05;
          changeVideoButton.textContent = "Return to Main"; // Set button label for new video
        }

        changeVideoButton.style.display = showButton ? "block" : "none";
      }

      // In your switchVideo function, make sure the button label is consistent
      function switchVideo(src, buttonLabel) {
        vid.pause();

        // Remove old source(s)
        while (vid.firstChild) {
          vid.removeChild(vid.firstChild);
        }

        // Add new <source>
        const newSource = document.createElement("source");
        newSource.setAttribute("src", src);
        newSource.setAttribute("type", "video/mp4");
        vid.appendChild(newSource);

        vid.load();
        // No need to set changeVideoButton.textContent here as it's handled in scroll()
        changeVideoButton.style.display = "none";

        // Scroll to top and wait for metadata
        window.scrollTo({ top: 0 });
      }

      changeVideoButton.addEventListener("click", () => {
        const currentSrc = vid.currentSrc || "";
        const currentFileName = currentSrc.substring(
          currentSrc.lastIndexOf("/") + 1
        );

        if (currentFileName === "vid.mp4") {
          switchVideo(newVideoSource); // No need to pass button label here, it's set in scroll()
        } else {
          switchVideo(initialVideoSource); // No need to pass button label here, it's set in scroll()
        }
      });

      function switchVideo(src, buttonLabel) {
        vid.pause();

        // Remove old source(s)
        while (vid.firstChild) {
          vid.removeChild(vid.firstChild);
        }

        // Add new <source>
        const newSource = document.createElement("source");
        newSource.setAttribute("src", src);
        newSource.setAttribute("type", "video/mp4");
        vid.appendChild(newSource);

        vid.load();
        changeVideoButton.textContent = buttonLabel;
        changeVideoButton.style.display = "none";

        // Scroll to top and wait for metadata
        window.scrollTo({ top: 0 });
      }

      changeVideoButton.addEventListener("click", () => {
        const currentSrc = vid.currentSrc || "";
        if (currentSrc.includes(initialVideoSource)) {
          switchVideo(newVideoSource, "Explore Equipment Rental");
        } else {
          switchVideo(initialVideoSource, "Explore Equipment Rental");
        }
      });

      vid.addEventListener("loadedmetadata", () => {
        console.log("--- loadedmetadata event fired! ---");
        setTimeout(scroll, 10); // slight delay to ensure duration is available
      });

      window.addEventListener("scroll", scroll);
      window.addEventListener("DOMContentLoaded", scroll);
    </script>
  </body>
</html>
